<script src="../dist/browser/tfjs-onnx.js"></script>
<script src="utils.js"></script>

<canvas id="img"></canvas>
<div id="result"></div>

<script>
  const imgUrl = 'img/mnist_5.png';
  const modelUrl = 'models/mnist/mnist.onnx';

  (async function(){
    // Load the image
    const imgElem = document.getElementById('img');
    const img = await tf.onnx.util.loadImageData(imgUrl);

    // Load the model
    const [model, onnx] = await tf.onnx.loadModel(modelUrl);
    console.debug(model);

    // Load the pixel and scale to model input
    const data = rgbToGrayscale(loadImageData(img, [28, 28]));

    // Visualize image
    displayImage(data, 'img');

    // Perform the forward pass and return the prediction
    const predictions = tf.tidy(() => {
      const logits = model.predict(onnx.getAllInputs(data));
      return logits.as1D().softmax();
    });

    // Output the result
    const topK = await getTopKClasses(predictions, 5);

    const probs = topK[0];
    const classNames = Array.from(topK[1]);

    displayLabel(probs, classNames, 'result');
  })();

</script>
